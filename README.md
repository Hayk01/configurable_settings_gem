# ConfigurableSettings

A Rails engine gem to easily add customizable settings for your models such as Firm, User, Clinic, etc.
It generates dynamic settings and setting definitions tables scoped by a user-defined base name.

---

## Features

* Generate setting definitions (`key`, `data_type`, `default_value`)
* Store settings per model instance (e.g., per Firm)
* Fully scaffolded models, controllers, and views for managing settings
* Supports any base model name you choose (`firm`, `user`, `clinic`, etc.)

---

## Installation

1. Add the gem to your application's Gemfile:

```ruby
gem "configurable_settings", git: "https://github.com/Hayk01/configurable_settings_gem.git"
```

> Replace the path with your actual gem location or use a published gem source.

2. Install the gem:

```bash
bundle install
```

---

## Setup

Run the install generator to create the necessary migrations, models, and controllers:

```bash
rails generate configurable_settings:install
```

You will be prompted to enter the base name for your settings. This should correspond to your existing model (e.g., `firm`, `user`, `clinic`).

Example:

```
Enter base name (e.g., firm, user, clinic):
> firm
```

The generator will create:

* Migration files to create `firm_setting_definitions` and `firm_settings` tables
* Scaffolded models, controllers, and views namespaced under `Firm`

---

## Run Migrations

After generation, migrate your database:

```bash
rails db:migrate
```

---

## Usage

### Managing Setting Definitions

Access the setting definitions UI at:

```
/firm/setting_definitions
```

Here you can create setting keys with:

* `key` — a unique identifier string
* `data_type` — type of data stored (e.g., string, integer)
* `default_value` — optional default

---

### Managing Settings

Settings belong to your base model instance. For example, to manage settings for a specific firm, use the scaffold UI:

```
/firm/settings
```

You can create, update, and delete settings for your firm instances.

---

### Programmatic Access

Example in your `Firm` model:

```ruby
class Firm < ApplicationRecord
  has_many :settings, class_name: "Firm::Setting"

  def setting_value(key)
    s = settings.joins(:setting_definition).find_by(firm_settings: { key: key })
    s&.value || Firm::SettingDefinition.find_by(key: key)&.default_value
  end

  def set_setting(key, val)
    definition = Firm::SettingDefinition.find_by!(key: key)
    setting = settings.find_or_initialize_by(setting_definition: definition)
    setting.value = val
    setting.save!
  end
end
```

---

## Mounting the Engine Routes (Optional)

If you want to access the gem’s UI under a dedicated path, add this to your `config/routes.rb`:

```ruby
mount ConfigurableSettings::Engine => "/configurable_settings"
```

---

## Customization

* Change base name during install for different models (e.g., `user`, `clinic`)
* Extend models or controllers generated by scaffolds for additional behavior
